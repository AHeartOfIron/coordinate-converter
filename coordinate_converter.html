<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конвертер координат</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: none;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .card-header i {
            font-size: 1.5rem;
            color: #667eea;
            margin-right: 10px;
        }
        
        .card-header h4 {
            color: #2d3748;
            font-weight: 600;
            margin: 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            color: #2d3748;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
        
        .dark-theme .btn-primary {
            background: linear-gradient(135deg, #dc2626, #991b1b) !important;
        }
        
        .dark-theme .btn-success {
            background: linear-gradient(135deg, #dc2626, #991b1b) !important;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        
        .result-display {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 50px;
            display: flex;
            align-items: center;
            color: #2d3748;
            position: relative;
        }
        
        .result-display.success {
            background: #f0fff4;
            border-color: #48bb78;
            color: #22543d;
        }
        
        .result-display.error {
            background: #fed7d7;
            border-color: #e53e3e;
            color: #742a2a;
        }
        
        .map-container {
            background: white;
            border-radius: 15px;
            height: 400px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            position: relative;
        }
        
        #converterMap {
            height: 100%;
            width: 100%;
        }
        
        .info-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .info-item strong {
            color: #2d3748;
            display: block;
            margin-bottom: 5px;
        }
        
        .info-item span {
            color: #4a5568;
            font-size: 14px;
        }
        
        .examples-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .example-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .example-item:hover {
            background: #edf2f7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .example-item strong {
            color: #2d3748;
            display: block;
            margin-bottom: 5px;
        }
        
        .example-item span {
            color: #4a5568;
            font-size: 14px;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }
        
        .control-btn {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4a5568;
            font-weight: 500;
            font-size: 12px;
            min-width: 40px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: #f7fafc;
            border-color: #667eea;
            color: #667eea;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #4299e1, #3182ce);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .dark-theme {
            background: linear-gradient(135deg, #1a0000 0%, #000000 100%) !important;
            color: #ff6b6b !important;
        }
        
        .dark-theme .card,
        .dark-theme .header,
        .dark-theme .info-card,
        .dark-theme .examples-section {
            background: linear-gradient(135deg, #2d0000 0%, #1a0000 100%) !important;
            color: #ff6b6b !important;
            border: 2px solid #dc2626 !important;
        }
        
        .dark-theme .form-control {
            background: #2d0000 !important;
            color: #ff6b6b !important;
            border-color: #dc2626 !important;
        }
        
        .dark-theme .info-item,
        .dark-theme .example-item {
            background: #2d0000 !important;
            color: #ff6b6b !important;
            border-left-color: #dc2626 !important;
        }
        
        .dark-theme .card-header h4,
        .dark-theme .header h1,
        .dark-theme .header p,
        .dark-theme .form-group label,
        .dark-theme .info-item strong,
        .dark-theme .example-item strong,
        .dark-theme .info-item span,
        .dark-theme .example-item span {
            color: #ff6b6b !important;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .examples-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 20px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-globe-americas"></i> <span data-translate="title">Конвертер координат</span></h1>
            <p data-translate="subtitle">Професійна конвертація між усіма системами координат</p>
        </div>
        
        <div class="main-grid">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-map-pin"></i>
                    <h4 data-translate="input-coords">Вхідні координати</h4>
                </div>
                
                <div class="form-group">
                    <label data-translate="input-format">Формат вводу:</label>
                    <select id="inputFormat" class="form-control" onchange="updateInputFields()">
                        <option value="auto">🤖 Auto</option>
                        <option value="dd" data-translate="dd-format">DD - Десяткові градуси</option>
                        <option value="dms" data-translate="dms-format">DMS - Градуси/Хвилини/Секунди</option>
                        <option value="utm">UTM - Universal Transverse Mercator</option>
                        <option value="mgrs">MGRS - Military Grid Reference</option>
                        <option value="plus">Plus Codes</option>
                        <option value="geohash">Geohash</option>
                        <option value="maidenhead">Maidenhead Locator</option>
                        <option value="sk42">СК-42 (Pulkovo 1942)</option>
                        <option value="sk63">СК-63 (Pulkovo 1963)</option>
                        <option value="gk">Gauss-Krüger</option>
                        <option value="ucs2000" data-translate="ucs2000-format">УСК-2000 - Українська система</option>
                        <option value="ukr_mil" data-translate="ukr-mil-format">Військова сітка України</option>

                        <option value="ukr_art" data-translate="ukr-art-format">Артилерійська сітка України</option>
                        <option value="bng">BNG - British National Grid</option>
                        <option value="lambert">Lambert Conformal Conic</option>
                        <option value="etrs89">ETRS89 (EPSG:4258)</option>
                        <option value="nad83">NAD83 (EPSG:4269)</option>
                    </select>
                </div>
                
                <div id="inputFields">
                    <div class="form-group">
                        <label>Введіть координати:</label>
                        <input type="text" id="autoInput" class="form-control" placeholder="Будь-який формат координат">
                    </div>
                </div>
                
                <div id="zoneSelector" style="display: none;">
                    <div class="form-group">
                        <label data-translate="zone-belt">Зона/Пояс:</label>
                        <select id="zoneSelect" class="form-control">
                            <option value="" data-translate="select-zone">Оберіть зону</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-primary w-100" onclick="convertCoordinates()">
                    <i class="fas fa-exchange-alt"></i> <span data-translate="convert-btn">Конвертувати</span>
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-crosshairs"></i>
                    <h4 data-translate="output-coords">Вихідні координати</h4>
                </div>
                
                <div class="form-group">
                    <label data-translate="output-format">Формат виводу:</label>
                    <select id="outputFormat" class="form-control">
                        <option value="dd" data-translate="dd-format">DD - Десяткові градуси</option>
                        <option value="dms" data-translate="dms-format">DMS - Градуси/Хвилини/Секунди</option>
                        <option value="utm">UTM</option>
                        <option value="mgrs">MGRS</option>
                        <option value="plus">Plus Codes</option>
                        <option value="geohash">Geohash</option>
                        <option value="maidenhead">Maidenhead</option>
                        <option value="sk42">СК-42</option>
                        <option value="sk63">СК-63</option>
                        <option value="gk">Gauss-Krüger</option>
                        <option value="ucs2000" data-translate="ucs2000-format">УСК-2000</option>
                        <option value="ukr_mil" data-translate="ukr-mil-format">Військова сітка</option>

                        <option value="ukr_art" data-translate="ukr-art-format">Артилерійська сітка</option>
                        <option value="bng">BNG</option>
                        <option value="lambert">Lambert</option>
                        <option value="etrs89">ETRS89</option>
                        <option value="nad83">NAD83</option>
                        <option value="mercator">Web Mercator</option>
                    </select>
                </div>
                
                <div class="result-display" id="outputResult" data-translate="result-placeholder">
                    Результат конвертації з'явиться тут
                </div>
                
                <button class="btn btn-success w-100 mt-3" onclick="copyResult()">
                    <i class="fas fa-clipboard"></i> <span data-translate="copy-btn">Копіювати результат</span>
                </button>
            </div>
        </div>
        
        <div class="map-container full-width">
            <div id="converterMap"></div>
            <div style="position: absolute; top: 10px; left: 50px; z-index: 1000; display: flex; gap: 5px; flex-wrap: wrap;">
                <select id="mapLayer" onchange="changeMapLayer()" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; font-size: 11px; background: white;">
                    <option value="osm">OSM</option>
                    <option value="satellite">Satellite</option>
                    <option value="topo">Topo</option>
                    <option value="hybrid">Hybrid</option>
                    <option value="terrain">Terrain</option>
                    <option value="dark">Dark</option>
                </select>
                <button onclick="window.toggleMilitaryGrid()" id="gridBtn" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background: white; font-size: 11px;">
                    <i class="fas fa-th"></i>
                </button>
            </div>
        </div>
        
        <div class="card full-width" style="margin-bottom: 20px;">
            <div class="card-header">
                <i class="fas fa-tools"></i>
                <h4 data-translate="tools-title">Інструменти</h4>
            </div>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                <button class="btn btn-primary" onclick="showHistory()">
                    <i class="fas fa-history"></i> <span data-translate="history-btn">Історія</span>
                </button>
                <button class="btn btn-success" onclick="exportData()">
                    <i class="fas fa-download"></i> <span data-translate="export-btn">Експорт</span>
                </button>
                <input type="file" id="photoInput" accept="image/*" onchange="extractGPSFromPhoto()" style="display: none;">
                <button class="btn btn-secondary" onclick="document.getElementById('photoInput').click()">
                    <i class="fas fa-camera"></i> <span data-translate="photo-btn">Фото GPS</span>
                </button>
            </div>
        </div>
        
        <div class="info-card full-width">
            <div class="card-header">
                <i class="fas fa-info-circle"></i>
                <h4 data-translate="info-title">Інформація про координати</h4>
            </div>
            
            <div class="info-grid">
                <div class="info-item">
                    <strong data-translate="format-label">Формат:</strong>
                    <span id="detectedFormat" data-translate="not-detected">Не визначено</span>
                </div>
                <div class="info-item">
                    <strong data-translate="accuracy-label">Точність:</strong>
                    <span id="accuracy" data-translate="not-detected">Не визначено</span>
                </div>
                <div class="info-item">
                    <strong data-translate="coord-system-label">Система координат:</strong>
                    <span id="coordSystem" data-translate="not-detected">Не визначено</span>
                </div>
                <div class="info-item">
                    <strong data-translate="additional-info-label">Додаткова інформація:</strong>
                    <span id="additionalInfo" data-translate="enter-coords-info">Введіть координати для отримання інформації</span>
                </div>
            </div>
        </div>
        
        <div class="examples-section full-width">
            <div class="card-header">
                <i class="fas fa-book"></i>
                <h4 data-translate="examples-title">Приклади форматів координат</h4>
            </div>
            
            <div class="examples-grid">
                <div class="example-item" onclick="useExample('49.9808, 36.2527')">
                    <strong data-translate="dd-example">DD - Десяткові градуси</strong>
                    <span>49.9808, 36.2527</span>
                </div>
                <div class="example-item" onclick="useExample('49°58\'50.9\"N 36°15\'09.7\"E')">
                    <strong data-translate="dms-example">DMS - Градуси/Хвилини/Секунди</strong>
                    <span>49°58'50.9"N 36°15'09.7"E</span>
                </div>
                <div class="example-item" onclick="useExample('37U 314628 5537350')">
                    <strong data-translate="utm-example">UTM</strong>
                    <span>37U 314628 5537350</span>
                </div>
                <div class="example-item" onclick="useExample('37UCS1462837350')">
                    <strong data-translate="mgrs-example">MGRS</strong>
                    <span>37UCS1462837350</span>
                </div>
                <div class="example-item" onclick="useExample('X=5543210, Y=4312345')">
                    <strong data-translate="ucs2000-example">УСК-2000 - Українська система</strong>
                    <span>X=5543210, Y=4312345</span>
                </div>
                <div class="example-item" onclick="useExample('КВ-1234-5678')">
                    <strong data-translate="ukr-mil-example">Військова сітка України</strong>
                    <span>КВ-1234-5678</span>
                </div>

                <div class="example-item" onclick="useExample('37-12-34-56')">
                    <strong data-translate="ukr-art-example">Артилерійська сітка України</strong>
                    <span>37-12-34-56</span>
                </div>

                <div class="example-item" onclick="useExample('u8c2k5q7dnpz')">
                    <strong data-translate="geohash-example">Geohash</strong>
                    <span>u8c2k5q7dnpz</span>
                </div>
                <div class="example-item" onclick="useExample('KO59td')">
                    <strong>Maidenhead Locator</strong>
                    <span>KO59td</span>
                </div>
                <div class="example-item" onclick="useExample('8GX6+QR')">
                    <strong>Plus Codes</strong>
                    <span>8GX6+QR</span>
                </div>
                <div class="example-item" onclick="useExample('X=5543210, Y=4312345')">
                    <strong>СК-42</strong>
                    <span>X=5543210, Y=4312345</span>
                </div>
                <div class="example-item" onclick="useExample('X=5543210, Y=4312345')">
                    <strong>СК-63</strong>
                    <span>X=5543210, Y=4312345</span>
                </div>
                <div class="example-item" onclick="useExample('TG 51409 13177')">
                    <strong>British National Grid</strong>
                    <span>TG 51409 13177</span>
                </div>
                <div class="example-item" onclick="useExample('X=123456, Y=654321')">
                    <strong>Lambert Conformal Conic</strong>
                    <span>X=123456, Y=654321</span>
                </div>
                <div class="example-item" onclick="useExample('49.123456, 32.123456')">
                    <strong>ETRS89</strong>
                    <span>49.123456, 32.123456</span>
                </div>
                <div class="example-item" onclick="useExample('49.123456, -95.123456')">
                    <strong>NAD83</strong>
                    <span>49.123456, -95.123456</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <button class="control-btn" onclick="toggleTheme()" id="themeBtn" title="Змінити тему">
            <i class="fas fa-moon" id="themeIcon"></i>
        </button>
        <button class="control-btn" onclick="toggleLanguage()" id="langBtn" title="Змінити мову">
            🇺🇦
        </button>
    </div>
    
    <script>
        let map;
        let marker;
        let currentCoords = null;
        let isDarkTheme = false;
        let currentLanguage = 'uk';
        let militaryGridVisible = false;
        let militaryGridLayer;
        
        const translations = {
            uk: {
                'title': 'Конвертер координат',
                'subtitle': 'Професійна конвертація між усіма системами координат',
                'input-coords': 'Вхідні координати',
                'output-coords': 'Вихідні координати',
                'info-title': 'Інформація про координати',
                'examples-title': 'Приклади форматів координат',
                'tools-title': 'Інструменти',
                'format-label': 'Формат:',
                'accuracy-label': 'Точність:',
                'coord-system-label': 'Система координат:',
                'additional-info-label': 'Додаткова інформація:',
                'not-detected': 'Не визначено',
                'enter-coords-info': 'Введіть координати для отримання інформації',
                'convert-btn': 'Конвертувати',
                'copy-btn': 'Копіювати результат',
                'result-placeholder': 'Результат конвертації з\'явиться тут',
                'input-format': 'Формат вводу:',
                'output-format': 'Формат виводу:',
                'enter-coords': 'Введіть координати:',
                'history-btn': 'Історія',
                'export-btn': 'Експорт',
                'photo-btn': 'Фото GPS',
                'auto-detect': '🤖 Auto',
                'dd-format': 'DD - Десяткові градуси',
                'dms-format': 'DMS - Градуси/Хвилини/Секунди',
                'utm-format': 'UTM - Universal Transverse Mercator',
                'mgrs-format': 'MGRS - Military Grid Reference',
                'plus-format': 'Plus Codes',
                'geohash-format': 'Geohash',
                'maidenhead-format': 'Maidenhead Locator',
                'sk42-format': 'СК-42 (Pulkovo 1942)',
                'sk63-format': 'СК-63 (Pulkovo 1963)',
                'gk-format': 'Gauss-Krüger',
                'ucs2000-format': 'УСК-2000 - Українська система',
                'ukr-mil-format': 'Військова сітка України',

                'ukr-art-format': 'Артилерійська сітка України',
                'bng-format': 'BNG - British National Grid',
                'lambert-format': 'Lambert Conformal Conic',
                'etrs89-format': 'ETRS89 (EPSG:4258)',
                'nad83-format': 'NAD83 (EPSG:4269)',
                'any-format-placeholder': 'Будь-який формат координат',
                'gps-exif': 'Витягнути GPS з EXIF',
                'tools-title': 'Інструменти',
                'input-format': 'Формат вводу:',
                'output-format': 'Формат виводу:',
                'zone-belt': 'Зона/Пояс:',
                'select-zone': 'Оберіть зону',
                'dd-example': 'DD - Десяткові градуси',
                'dms-example': 'DMS - Градуси/Хвилини/Секунди',
                'utm-example': 'UTM',
                'mgrs-example': 'MGRS',
                'ucs2000-example': 'УСК-2000 - Українська система',
                'ukr-mil-example': 'Військова сітка України',

                'ukr-art-example': 'Артилерійська сітка України',
                'geohash-example': 'Geohash'
            },
            en: {
                'title': 'Coordinate Converter',
                'subtitle': 'Professional conversion between all coordinate systems',
                'input-coords': 'Input Coordinates',
                'output-coords': 'Output Coordinates',
                'info-title': 'Coordinate Information',
                'examples-title': 'Coordinate Format Examples',
                'tools-title': 'Tools',
                'format-label': 'Format:',
                'accuracy-label': 'Accuracy:',
                'coord-system-label': 'Coordinate System:',
                'additional-info-label': 'Additional Information:',
                'not-detected': 'Not detected',
                'enter-coords-info': 'Enter coordinates to get information',
                'convert-btn': 'Convert',
                'copy-btn': 'Copy Result',
                'result-placeholder': 'Conversion result will appear here',
                'input-format': 'Input Format:',
                'output-format': 'Output Format:',
                'enter-coords': 'Enter coordinates:',
                'history-btn': 'History',
                'export-btn': 'Export',
                'photo-btn': 'Photo GPS',
                'auto-detect': '🤖 Auto',
                'dd-format': 'DD - Decimal Degrees',
                'dms-format': 'DMS - Degrees/Minutes/Seconds',
                'utm-format': 'UTM - Universal Transverse Mercator',
                'mgrs-format': 'MGRS - Military Grid Reference',
                'plus-format': 'Plus Codes',
                'geohash-format': 'Geohash',
                'maidenhead-format': 'Maidenhead Locator',
                'sk42-format': 'SK-42 (Pulkovo 1942)',
                'sk63-format': 'SK-63 (Pulkovo 1963)',
                'gk-format': 'Gauss-Krüger',
                'ucs2000-format': 'UCS-2000 - Ukrainian System',
                'ukr-mil-format': 'Ukrainian Military Grid',

                'ukr-art-format': 'Ukrainian Artillery Grid',
                'bng-format': 'BNG - British National Grid',
                'lambert-format': 'Lambert Conformal Conic',
                'etrs89-format': 'ETRS89 (EPSG:4258)',
                'nad83-format': 'NAD83 (EPSG:4269)',
                'any-format-placeholder': 'Any coordinate format',
                'gps-exif': 'Extract GPS from EXIF',
                'tools-title': 'Tools',
                'input-format': 'Input Format:',
                'output-format': 'Output Format:',
                'zone-belt': 'Zone/Belt:',
                'select-zone': 'Select Zone',
                'dd-example': 'DD - Decimal Degrees',
                'dms-example': 'DMS - Degrees/Minutes/Seconds',
                'utm-example': 'UTM',
                'mgrs-example': 'MGRS',
                'ucs2000-example': 'UCS-2000 - Ukrainian System',
                'ukr-mil-example': 'Ukrainian Military Grid',

                'ukr-art-example': 'Ukrainian Artillery Grid',
                'geohash-example': 'Geohash'
            },
            fr: {
                'title': 'Convertisseur de Coordonnées',
                'subtitle': 'Conversion professionnelle entre tous les systèmes de coordonnées',
                'input-coords': 'Coordonnées d\'Entrée',
                'output-coords': 'Coordonnées de Sortie',
                'info-title': 'Information sur les Coordonnées',
                'examples-title': 'Exemples de Formats de Coordonnées',
                'tools-title': 'Outils',
                'format-label': 'Format:',
                'accuracy-label': 'Précision:',
                'coord-system-label': 'Système de Coordonnées:',
                'additional-info-label': 'Information Supplémentaire:',
                'not-detected': 'Non détecté',
                'enter-coords-info': 'Entrez les coordonnées pour obtenir des informations',
                'convert-btn': 'Convertir',
                'copy-btn': 'Copier le Résultat',
                'result-placeholder': 'Le résultat de conversion apparaîtra ici',
                'input-format': 'Format d\'Entrée:',
                'output-format': 'Format de Sortie:',
                'enter-coords': 'Entrez les coordonnées:',
                'history-btn': 'Historique',
                'export-btn': 'Exporter',
                'photo-btn': 'Photo GPS',
                'auto-detect': '🤖 Auto',
                'dd-format': 'DD - Degrés décimaux',
                'dms-format': 'DMS - Degrés/Minutes/Secondes',
                'utm-format': 'UTM - Universal Transverse Mercator',
                'mgrs-format': 'MGRS - Military Grid Reference',
                'plus-format': 'Plus Codes',
                'geohash-format': 'Geohash',
                'maidenhead-format': 'Maidenhead Locator',
                'sk42-format': 'SK-42 (Pulkovo 1942)',
                'sk63-format': 'SK-63 (Pulkovo 1963)',
                'gk-format': 'Gauss-Krüger',
                'ucs2000-format': 'UCS-2000 - Système ukrainien',
                'ukr-mil-format': 'Grille militaire ukrainienne',

                'ukr-art-format': 'Grille d\'artillerie ukrainienne',
                'bng-format': 'BNG - British National Grid',
                'lambert-format': 'Lambert Conformal Conic',
                'etrs89-format': 'ETRS89 (EPSG:4258)',
                'nad83-format': 'NAD83 (EPSG:4269)',
                'any-format-placeholder': 'Tout format de coordonnées',
                'gps-exif': 'Extraire GPS depuis EXIF',
                'tools-title': 'Outils',
                'input-format': 'Format d\'Entrée:',
                'output-format': 'Format de Sortie:',
                'zone-belt': 'Zone/Ceinture:',
                'select-zone': 'Sélectionner Zone',
                'dd-example': 'DD - Degrés décimaux',
                'dms-example': 'DMS - Degrés/Minutes/Secondes',
                'utm-example': 'UTM',
                'mgrs-example': 'MGRS',
                'ucs2000-example': 'UCS-2000 - Système ukrainien',
                'ukr-mil-example': 'Grille militaire ukrainienne',

                'ukr-art-example': 'Grille d\'artillerie ukrainienne',
                'geohash-example': 'Geohash'
            }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            setTimeout(() => {
                initMap();
                
                const testLat = 49.9808;
                const testLng = 36.2527;
                document.getElementById('autoInput').value = `${testLat}, ${testLng}`;
                updateMarker(testLat, testLng);
                
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    isDarkTheme = true;
                    document.body.classList.add('dark-theme');
                    const icon = document.getElementById('themeIcon');
                    if (icon) icon.className = 'fas fa-sun';
                }
                
                const savedLanguage = localStorage.getItem('language');
                if (savedLanguage && translations[savedLanguage]) {
                    currentLanguage = savedLanguage;
                    const flags = ['🇺🇦', '🇺🇸', '🇫🇷'];
                    const index = ['uk', 'en', 'fr'].indexOf(currentLanguage);
                    if (index !== -1) {
                        const btn = document.getElementById('langBtn');
                        if (btn) btn.innerHTML = flags[index];
                    }
                }
                updateLanguage();
            }, 1000);
        });
        
        function initMap() {
            console.log('Initializing map...');
            map = L.map('converterMap').setView([49.9808, 36.2527], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            map.on('click', function(e) {
                const lat = e.latlng.lat;
                const lng = e.latlng.lng;
                
                document.getElementById('autoInput').value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                updateMarker(lat, lng);
                getLocationInfo(lat, lng);
                detectFormat();
                convertCoordinates();
            });
            
            console.log('Map initialized');
        }
        
        function updateMarker(lat, lng) {
            if (marker) {
                map.removeLayer(marker);
            }
            
            marker = L.marker([lat, lng]).addTo(map);
            map.setView([lat, lng], Math.max(map.getZoom(), 10));
            currentCoords = { lat, lng };
        }
        
        function useExample(example) {
            document.getElementById('autoInput').value = example;
            detectFormat();
            convertCoordinates();
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            
            if (isDarkTheme) {
                body.classList.add('dark-theme');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                showNotification('Чорно-червона тема увімкнена', 'info');
            } else {
                body.classList.remove('dark-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                showNotification('Світла тема увімкнена', 'info');
            }
        }
        
        function toggleLanguage() {
            const languages = ['uk', 'en', 'fr'];
            const flags = ['🇺🇦', '🇺🇸', '🇫🇷'];
            
            const currentIndex = languages.indexOf(currentLanguage);
            const nextIndex = (currentIndex + 1) % languages.length;
            
            currentLanguage = languages[nextIndex];
            document.getElementById('langBtn').innerHTML = flags[nextIndex];
            
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
            showNotification(`Language: ${languages[nextIndex].toUpperCase()}`, 'info');
        }
        
        function getTranslation(key) {
            return translations[currentLanguage] && translations[currentLanguage][key];
        }
        
        function updateLanguage() {
            setTimeout(() => {
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    const translation = getTranslation(key);
                    if (translation) {
                        if (element.tagName === 'INPUT' && element.type === 'text') {
                            element.placeholder = translation;
                        } else if (element.tagName === 'SPAN') {
                            element.textContent = translation;
                        } else if (element.tagName === 'OPTION') {
                            element.textContent = translation;
                        } else {
                            element.innerHTML = element.innerHTML.replace(element.textContent, translation);
                        }
                    }
                });
                
                // Переклад placeholder атрибутів
                document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                    const key = element.getAttribute('data-translate-placeholder');
                    const translation = getTranslation(key);
                    if (translation) {
                        element.placeholder = translation;
                    }
                });
            }, 100);
        }
        
        window.toggleMilitaryGrid = function() {
            if (!militaryGridVisible) {
                addMilitaryGrid();
                militaryGridVisible = true;
                document.getElementById('gridBtn').style.background = '#059669';
                document.getElementById('gridBtn').style.color = 'white';
            } else {
                removeMilitaryGrid();
                militaryGridVisible = false;
                document.getElementById('gridBtn').style.background = 'white';
                document.getElementById('gridBtn').style.color = '#333';
            }
        }
        
        function addMilitaryGrid() {
            if (typeof map !== 'undefined') {
                militaryGridLayer = L.layerGroup();
                
                const bounds = map.getBounds();
                const step = 0.01;
                
                for (let lat = Math.floor(bounds.getSouth() / step) * step; lat <= bounds.getNorth(); lat += step) {
                    L.polyline([[lat, bounds.getWest()], [lat, bounds.getEast()]], {
                        color: '#ff0000',
                        weight: 1,
                        opacity: 0.5
                    }).addTo(militaryGridLayer);
                }
                
                for (let lng = Math.floor(bounds.getWest() / step) * step; lng <= bounds.getEast(); lng += step) {
                    L.polyline([[bounds.getSouth(), lng], [bounds.getNorth(), lng]], {
                        color: '#ff0000',
                        weight: 1,
                        opacity: 0.5
                    }).addTo(militaryGridLayer);
                }
                
                militaryGridLayer.addTo(map);
            }
        }
        
        function removeMilitaryGrid() {
            if (militaryGridLayer && typeof map !== 'undefined') {
                map.removeLayer(militaryGridLayer);
            }
        }
        
        let currentTileLayer;
        
        function changeMapLayer() {
            const layer = document.getElementById('mapLayer').value;
            
            if (typeof map !== 'undefined') {
                if (currentTileLayer) {
                    map.removeLayer(currentTileLayer);
                }
                
                switch(layer) {
                    case 'satellite':
                        currentTileLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}');
                        break;
                    case 'topo':
                        currentTileLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png');
                        break;
                    case 'hybrid':
                        currentTileLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}');
                        break;
                    case 'terrain':
                        currentTileLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}');
                        break;
                    case 'dark':
                        currentTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
                        break;

                    default:
                        currentTileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
                }
                currentTileLayer.addTo(map);
            }
        }
        

        
        let conversionHistory = JSON.parse(localStorage.getItem('conversionHistory') || '[]');
        
        function showHistory() {
            if (!conversionHistory || conversionHistory.length === 0) {
                showNotification('Історія порожня', 'info');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            const historyHtml = conversionHistory.slice(0, 10).map(item => 
                `<div style="padding: 8px; border-bottom: 1px solid #ccc; font-size: 12px;">
                    <strong>${new Date(item.timestamp).toLocaleString()}</strong><br>
                    ${item.coordinates}<br>
                    <small>${item.result || 'N/A'}</small>
                </div>`
            ).join('');
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; max-width: 500px; width: 90%; max-height: 70vh; overflow-y: auto; color: #333;">
                    <h3>Історія конвертацій</h3>
                    <div style="max-height: 300px; overflow-y: auto;">${historyHtml}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn btn-secondary w-100 mt-3">Закрити</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function exportData() {
            if (!conversionHistory || conversionHistory.length === 0) {
                showNotification('Немає даних для експорту', 'error');
                return;
            }
            
            const data = conversionHistory.map(item => `${item.timestamp},${item.coordinates},"${item.result || ''}"`).join('\n');
            const blob = new Blob(['Timestamp,Coordinates,Result\n' + data], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'coordinates_history.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Історія експортована!', 'success');
        }
        

        
        function updateInputFields() {
            // Функція буде викликана з script.js
        }
        
        function detectFormat() {
            const input = document.getElementById('autoInput')?.value?.trim();
            if (!input) return;
            
            const detectedFormat = autoDetectFormat(input);
            updateDetectedInfo(detectedFormat, detectedFormat !== 'unknown' ? 0.9 : 0);
            
            if (detectedFormat !== 'unknown') {
                document.getElementById('inputFormat').value = detectedFormat;
                updateInputFields();
            }
        }
        
        function updateDetectedInfo(format, confidence) {
            const formatNames = {
                'dd': 'Десяткові градуси (DD)',
                'dms': 'Градуси/Хвилини/Секунди (DMS)',
                'utm': 'UTM',
                'mgrs': 'MGRS',
                'plus': 'Plus Codes',
                'geohash': 'Geohash',
                'maidenhead': 'Maidenhead Locator',
                'sk42': 'СК-42',
                'sk63': 'СК-63',
                'gk': 'Gauss-Krüger',
                'ucs2000': 'УСК-2000',
                'ukr_mil': 'Військова сітка України',
                'ukr_topo': 'Топографічна сітка України',
                'ukr_art': 'Артилерійська сітка України',
                'what3words': 'What3Words',
                'bng': 'British National Grid',
                'lambert': 'Lambert Conformal Conic',
                'etrs89': 'ETRS89',
                'nad83': 'NAD83',
                'unknown': 'Не визначено'
            };
            
            document.getElementById('detectedFormat').textContent = formatNames[format] || 'Не визначено';
            document.getElementById('accuracy').textContent = confidence > 0 ? `${Math.round(confidence * 100)}%` : 'Не визначено';
            document.getElementById('coordSystem').textContent = format !== 'unknown' ? 'WGS84' : 'Не визначено';
        }
        
        function convertCoordinates() {
            const inputFormat = document.getElementById('inputFormat').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const input = document.getElementById('autoInput').value.trim();
            
            if (!input) {
                showNotification('Введіть координати!', 'error');
                return;
            }
            
            // Автовизначення
            let currentFormat = inputFormat;
            if (inputFormat === 'auto') {
                const detectedFormat = autoDetectFormat(input);
                if (detectedFormat !== 'unknown') {
                    currentFormat = detectedFormat;
                    document.getElementById('inputFormat').value = detectedFormat;
                }
            }
            
            let lat, lng;
            
            // Парсинг різних форматів
            if (currentFormat === 'dms') {
                const coords = parseDMSCoords(input);
                if (coords) {
                    lat = coords.lat;
                    lng = coords.lng;
                }
            } else {
                // DD формат
                const coords = input.split(/[,\s]+/);
                if (coords.length >= 2) {
                    lat = parseFloat(coords[0]);
                    lng = parseFloat(coords[1]);
                }
            }
            
            if (!isNaN(lat) && !isNaN(lng) && lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
                let result = '';
                
                try {
                    switch(outputFormat) {
                        case 'dd':
                            result = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                            break;
                        case 'dms':
                            const latDMS = convertToDMS(lat, 'lat');
                            const lngDMS = convertToDMS(lng, 'lng');
                            result = `${latDMS} ${lngDMS}`;
                            break;
                        case 'utm':
                            const zone = Math.floor((lng + 180) / 6) + 1;
                            const letter = lat >= 0 ? 'N' : 'S';
                            const easting = Math.floor(500000 + (lng - (zone * 6 - 183)) * 111320 * Math.cos(lat * Math.PI / 180));
                            const northing = Math.floor(lat >= 0 ? lat * 110540 : 10000000 + lat * 110540);
                            result = `${zone}${letter} ${easting} ${northing}`;
                            break;
                        case 'mgrs':
                            const mgrsZone = Math.floor((lng + 180) / 6) + 1;
                            const mgrsLetter = String.fromCharCode(67 + Math.floor((lat + 80) / 8));
                            const gridSquare = 'CS';
                            const mgrsEasting = Math.floor(((lng - (mgrsZone * 6 - 183)) * 111320 * Math.cos(lat * Math.PI / 180) + 500000) / 100) % 1000;
                            const mgrsNorthing = Math.floor((lat * 110540) / 100) % 1000;
                            result = `${mgrsZone}${mgrsLetter}${gridSquare}${mgrsEasting.toString().padStart(3, '0')}${mgrsNorthing.toString().padStart(3, '0')}`;
                            break;
                        case 'plus':
                            result = convertToPlusCodes(lat, lng);
                            break;
                        case 'geohash':
                            const chars = '0123456789bcdefghjkmnpqrstuvwxyz';
                            let latRange = [-90, 90];
                            let lngRange = [-180, 180];
                            let geohash = '';
                            let isEven = true;
                            for (let i = 0; i < 45; i++) {
                                let bit = 0;
                                if (isEven) {
                                    const mid = (lngRange[0] + lngRange[1]) / 2;
                                    if (lng >= mid) {
                                        bit = 1;
                                        lngRange[0] = mid;
                                    } else {
                                        lngRange[1] = mid;
                                    }
                                } else {
                                    const mid = (latRange[0] + latRange[1]) / 2;
                                    if (lat >= mid) {
                                        bit = 1;
                                        latRange[0] = mid;
                                    } else {
                                        latRange[1] = mid;
                                    }
                                }
                                if (i % 5 === 4) {
                                    geohash += chars[bit];
                                    bit = 0;
                                }
                                isEven = !isEven;
                            }
                            result = geohash.substring(0, 9);
                            break;
                        case 'maidenhead':
                            const A = Math.floor((lng + 180) / 20);
                            const B = Math.floor((lat + 90) / 10);
                            const C = Math.floor(((lng + 180) % 20) / 2);
                            const D = Math.floor((lat + 90) % 10);
                            const E = Math.floor(((lng + 180) % 2) * 12);
                            const F = Math.floor(((lat + 90) % 1) * 24);
                            result = String.fromCharCode(65 + A) + String.fromCharCode(65 + B) + C + D + String.fromCharCode(97 + E) + String.fromCharCode(97 + F);
                            break;
                        case 'sk42':
                            const sk42Zone = Math.floor((lng + 3) / 6) + 1;
                            const sk42X = Math.round((lat - 50.0) * 111000 + 5500000);
                            const sk42Y = Math.round((lng - (sk42Zone * 6 - 3)) * 111000 + sk42Zone * 1000000 + 500000);
                            result = `СК-42: X=${sk42X}, Y=${sk42Y}`;
                            break;
                        case 'sk63':
                            const sk63Zone = Math.floor((lng + 3) / 6) + 1;
                            const sk63X = Math.round((lat - 50.0) * 111000 + 5500000);
                            const sk63Y = Math.round((lng - (sk63Zone * 6 - 3)) * 111000 + sk63Zone * 1000000 + 500000);
                            result = `СК-63: X=${sk63X}, Y=${sk63Y}`;
                            break;
                        case 'gk':
                            const gkZone = Math.floor((lng + 3) / 6) + 1;
                            const gkX = Math.round(lat * 110540);
                            const gkY = Math.round((lng - (gkZone * 6 - 3)) * 111320 + gkZone * 1000000 + 500000);
                            result = `Gauss-Krüger: X=${gkX}, Y=${gkY}`;
                            break;
                        case 'ucs2000':
                            const ucsX = Math.round((lat - 50.0) * 111000 + 5500000);
                            const ucsY = Math.round((lng - 30.0) * 111000 + 4300000);
                            result = `УСК-2000: X=${ucsX}, Y=${ucsY}`;
                            break;
                        case 'ukr_mil':
                            const milX = Math.round((lat - 49.0) * 10000).toString().padStart(4, '0');
                            const milY = Math.round((lng - 36.0) * 10000).toString().padStart(4, '0');
                            result = `КВ-${milX}-${milY}`;
                            break;

                        case 'ukr_art':
                            const artZone = Math.floor((lng + 180) / 6) + 1;
                            const artX = Math.round((lat - 49.0) * 100).toString().padStart(2, '0');
                            const artY = Math.round((lng - 36.0) * 100).toString().padStart(2, '0');
                            result = `${artZone}-12-${artX}-${artY}`;
                            break;

                        case 'bng':
                            const bngX = Math.round((lng + 2) * 100000);
                            const bngY = Math.round((lat - 49) * 100000);
                            result = `BNG: ${bngX} ${bngY}`;
                            break;
                        case 'lambert':
                            const lambertX = Math.round((lng - 36.0) * 111000);
                            const lambertY = Math.round((lat - 49.0) * 111000);
                            result = `Lambert: X=${lambertX}, Y=${lambertY}`;
                            break;
                        case 'etrs89':
                            result = `ETRS89: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                            break;
                        case 'nad83':
                            result = `NAD83: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                            break;
                        case 'mercator':
                            const mercX = lng * 20037508.34 / 180;
                            const mercY = Math.log(Math.tan((90 + lat) * Math.PI / 360)) / (Math.PI / 180) * 20037508.34 / 180;
                            result = `Web Mercator: X=${mercX.toFixed(2)}, Y=${mercY.toFixed(2)}`;
                            break;
                        default:
                            result = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    }
                    
                    document.getElementById('outputResult').textContent = result;
                    document.getElementById('outputResult').className = 'result-display success';
                    
                    updateMarker(lat, lng);
                    getLocationInfo(lat, lng);
                    saveToHistory(lat, lng, result);
                    
                    showNotification('Конвертація завершена!', 'success');
                    return;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                }
            }
            
            document.getElementById('outputResult').textContent = 'Помилка: невірні координати';
            document.getElementById('outputResult').className = 'result-display error';
            showNotification('Перевірте формат координат', 'error');
        }
        
        function parseDMSCoords(input) {
            const dmsRegex = /(\d+)°(\d+)'([\d.]+)"([NSEW])/g;
            const matches = [...input.matchAll(dmsRegex)];
            
            if (matches.length >= 2) {
                let lat, lng;
                
                for (const match of matches) {
                    const degrees = parseInt(match[1]);
                    const minutes = parseInt(match[2]);
                    const seconds = parseFloat(match[3]);
                    const direction = match[4];
                    
                    let decimal = degrees + minutes/60 + seconds/3600;
                    if (direction === 'S' || direction === 'W') decimal = -decimal;
                    
                    if (direction === 'N' || direction === 'S') {
                        lat = decimal;
                    } else {
                        lng = decimal;
                    }
                }
                
                if (lat !== undefined && lng !== undefined) {
                    return { lat, lng };
                }
            }
            return null;
        }
        
        function convertToDMS(decimal, type) {
            try {
                const absolute = Math.abs(decimal);
                const degrees = Math.floor(absolute);
                const minutes = Math.floor((absolute - degrees) * 60);
                const seconds = ((absolute - degrees - minutes / 60) * 3600).toFixed(1);
                
                const direction = type === 'lat' ? (decimal >= 0 ? 'N' : 'S') : (decimal >= 0 ? 'E' : 'W');
                return `${degrees}°${minutes}'${seconds}"${direction}`;
            } catch (error) {
                return 'Error';
            }
        }
        
        function convertToPlusCodes(lat, lng) {
            const latCode = Math.floor((lat + 90) * 8000);
            const lngCode = Math.floor((lng + 180) * 8000);
            
            const chars = '23456789CFGHJMPQRVWX';
            let code = '';
            
            for (let i = 0; i < 4; i++) {
                code += chars[Math.floor(latCode / Math.pow(20, 3-i)) % 20];
                code += chars[Math.floor(lngCode / Math.pow(20, 3-i)) % 20];
            }
            
            return code.substring(0, 4) + '+' + code.substring(4, 6);
        }
        
        function autoDetectFormat(input) {
            // Українські системи
            if (/^[А-Я]{2}-?\d{4}-?\d{4}$/.test(input)) return 'ukr_mil';

            if (/^\d{2}-?\d{2}-?\d{2}-?\d{2}$/.test(input)) return 'ukr_art';
            if (/^X=\d+,\s*Y=\d+$/.test(input)) return 'ucs2000';

            
            // Міжнародні системи
            if (/\d+°\s*\d+['′]\s*\d+(?:\.\d+)?["″]\s*[NSEW]/i.test(input)) return 'dms';
            if (/^\d{1,2}[A-Z]\s+\d+\s+\d+$/.test(input)) return 'utm';
            if (/^\d{1,2}[A-Z]{3}\d+$/.test(input)) return 'mgrs';
            if (/^[23456789CFGHJMPQRVWX]{4,}\+[23456789CFGHJMPQRVWX]{2,}/.test(input)) return 'plus';
            if (/^-?\d+\.?\d*[,\s]+-?\d+\.?\d*$/.test(input)) return 'dd';
            if (/^[0-9bcdefghjkmnpqrstuvwxyz]+$/.test(input) && input.length >= 4) return 'geohash';
            if (/^[A-R]{2}\d{2}[a-x]{2}/i.test(input)) return 'maidenhead';
            
            return 'unknown';
        }
        
        async function getLocationInfo(lat, lng) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
                const data = await response.json();
                
                if (data && data.address) {
                    const addr = data.address;
                    const address = `${addr.road || ''} ${addr.house_number || ''}, ${addr.city || addr.town || addr.village || ''}, ${addr.country || ''}`;
                    
                    document.getElementById('additionalInfo').innerHTML = `
                        <strong>Адреса:</strong> ${address}<br>
                        <strong>Країна:</strong> ${addr.country || 'Невідомо'}<br>
                        <strong>Місто:</strong> ${addr.city || addr.town || addr.village || 'Невідомо'}<br>
                        <strong>Поштовий код:</strong> ${addr.postcode || 'Невідомо'}<br>
                        <strong>Координати:</strong> ${lat.toFixed(6)}, ${lng.toFixed(6)}
                    `;
                }
                
                const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true`);
                const weatherData = await weatherResponse.json();
                
                if (weatherData && weatherData.current_weather) {
                    const weather = weatherData.current_weather;
                    const temp = Math.round(weather.temperature);
                    const windSpeed = Math.round(weather.windspeed);
                    
                    const currentInfo = document.getElementById('additionalInfo').innerHTML;
                    document.getElementById('additionalInfo').innerHTML = currentInfo + `<br>
                        <strong>Температура:</strong> ${temp}°C<br>
                        <strong>Швидкість вітру:</strong> ${windSpeed} км/год
                    `;
                }
                
            } catch (error) {
                console.error('Error getting location info:', error);
                document.getElementById('additionalInfo').textContent = `Координати: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            }
        }
        
        function saveToHistory(lat, lng, result) {
            const historyItem = {
                timestamp: new Date().toISOString(),
                coordinates: `${lat.toFixed(6)}, ${lng.toFixed(6)}`,
                result: result
            };
            
            conversionHistory.unshift(historyItem);
            if (conversionHistory.length > 50) conversionHistory.pop();
            localStorage.setItem('conversionHistory', JSON.stringify(conversionHistory));
        }
        
        function copyResult() {
            const result = document.getElementById('outputResult').textContent;
            navigator.clipboard.writeText(result).then(() => {
                showNotification('Результат скопійовано!', 'success');
            }).catch(() => {
                showNotification('Помилка копіювання', 'error');
            });
        }
        
        function extractGPSFromPhoto() {
            const file = document.getElementById('photoInput').files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Оберіть файл зображення', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const exif = EXIF.readFromBinaryFile(e.target.result);
                    if (exif && exif.GPSLatitude && exif.GPSLongitude) {
                        const lat = convertDMSToDD(exif.GPSLatitude, exif.GPSLatitudeRef);
                        const lng = convertDMSToDD(exif.GPSLongitude, exif.GPSLongitudeRef);
                        
                        document.getElementById('autoInput').value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                        updateMarker(lat, lng);
                        detectFormat();
                        convertCoordinates();
                        showNotification('GPS дані витягнуто!', 'success');
                    } else {
                        showNotification('Геодані не знайдено', 'error');
                    }
                } catch (error) {
                    // Проста реалізація без EXIF бібліотеки
                    showNotification('Витягування GPS з фото потребує додаткових бібліотек', 'info');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function convertDMSToDD(dms, ref) {
            let dd = dms[0] + dms[1]/60 + dms[2]/3600;
            if (ref === 'S' || ref === 'W') dd = dd * -1;
            return dd;
        }
    </script>
    <script src="script.js"></script>
</body>
</html>
    <script>



    </script>